#compdef mcpx

_mcpx() {
  local -a commands
  commands=(
    'list:List configured servers and tools'
    'call:Call a tool by selector or URL'
  )

  local -a global_flags
  global_flags=(
    '--config[Path to mcpx.json]:file:_files'
    '--root[Working directory for stdio servers]:dir:_directories'
    '--log-level[Logging level]:level:(debug info warn error)'
    '--oauth-timeout[OAuth browser timeout in ms]:milliseconds:'
    '--help[Show help]'
    '--version[Show version]'
  )

  _arguments -C \
    $global_flags \
    '1: :->command' \
    '*::arg:->args'

  case $state in
    command)
      _describe 'command' commands
      ;;
    args)
      case $words[1] in
        list)
          _arguments \
            $global_flags \
            '--output[Output format]:format:(auto text json toon raw)' \
            '--timeout[List operation timeout in ms]:milliseconds:' \
            '*:server name:'
          ;;
        call)
          _arguments \
            $global_flags \
            '--output[Output format]:format:(auto text json toon raw)' \
            '--timeout[Call timeout in ms]:milliseconds:' \
            '--http-url[Ad-hoc HTTP server URL]:url:' \
            '--stdio[Ad-hoc stdio server command]:command:' \
            '--env[Environment variables]:vars:' \
            '--cwd[Working directory]:dir:_directories' \
            '--name[Server name for ad-hoc server]:name:' \
            '--persist[Persist ad-hoc server to config]' \
            '*:tool selector:'
          ;;
      esac
      ;;
  esac
}

_mcpx "$@"
